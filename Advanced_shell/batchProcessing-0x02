#!/usr/bin/env bash
# fetch multiple pokemon
# fetch data from each of the selected pokemeon and save their data

set -euo pipefail

# directory to save that data
DATA_DIR="pokemon_data"
mkdir -p "$DATA_DIR"

# pokemon list
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")


BASE_URL="https://pokeapi.co/api/v2/pokemon"

#loop through the list
for name in "${POKEMON_LIST[@]}"; do
  echo "Fetching data for ${name}..."

  # output file for each
  OUT_FILE="${DATA_DIR}/${name}.json"

  #curl data
  response_code=$(curl -s -o "$OUT_FILE" -w "%{http_code}" "${BASE_URL}/${name}")

  #check response
  if [[ "$response_code" -eq 200 ]]; then
    echo "Saved data to ${OUT_FILE}"
  else
    echo "Failed to fetch data for ${name} (HTTP ${response_code})"
    rm -f "$OUT_FILE"
  fi

  # wait to repeat
  sleep 2
done
